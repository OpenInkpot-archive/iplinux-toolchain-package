#!/usr/bin/make -f

ifeq (,$(TARGET))
  $(error Empty TARGET variable)
endif

GNUTARGET := $(shell env -i dpkg-architecture -a$(TARGET) -qDEB_HOST_GNU_TYPE 2>/dev/null | sed -e 's/_/-/g')
GCCVERSION := 4.3

clean:
	dh_testdir
	dh_prep

	[ ! -e debian/control.orig ] || mv -f debian/control.orig debian/control

	dh_clean

build: build-stamp
build-stamp:
	dh_testdir

	[ -e debian/control.orig ] || cp debian/control debian/control.orig
	sed -e "s/__GNUTARGET__/$(GNUTARGET)/g" \
		-e "s/__TARGET__/$(TARGET)/g" \
		-e "s/__GCCVERSION__/$(GCCVERSION)/g" \
		-i debian/control

	touch $@

install: build
	dh_testdir
	dh_testroot
	dh_prep

binary-arch: install

binary-indep: install
	dh_testdir
	dh_testroot

	dh_installchangelogs
	dh_installdeb
	dh_gencontrol
	dh_builddeb

binary: binary-arch binary-indep

.PHONY: clean build install binary-arch binary
